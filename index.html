<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Libros iOS 18</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F2F2F7">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3389/3389081.png">

    <style>
        :root {
            --bg-color: #F2F2F7;
            --card-bg: #FFFFFF;
            --primary: #007AFF;
            --text-main: #000000;
            --text-sec: #8E8E93;
            --danger: #FF3B30;
            --success: #34C759;
            --radius: 20px;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
            --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-stack);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            padding-bottom: 90px; /* Espacio para el navbar */
            color: var(--text-main);
            overflow-x: hidden;
        }

        h1, h2, h3 { margin: 0; font-weight: 700; letter-spacing: -0.5px; }
        h1 { font-size: 34px; padding: 20px 20px 10px 20px; }

        /* Componentes UI */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin: 15px 20px;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 50px; /* Pill shape */
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn.secondary { background: #E5E5EA; color: var(--primary); }
        .btn.success { background: var(--success); }
        .btn.small { width: auto; padding: 8px 16px; font-size: 14px; }

        input, select {
            width: 100%;
            padding: 16px;
            background: #F2F2F7;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 12px;
            font-family: var(--font-stack);
        }

        /* Navegaci√≥n Inferior (TabBar) */
        .tab-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 25px 0; /* Extra padding para iPhone Home Indicator */
            z-index: 100;
        }

        .tab-item {
            text-align: center;
            font-size: 10px;
            color: var(--text-sec);
            cursor: pointer;
            width: 20%;
        }

        .tab-item.active { color: var(--primary); }
        .tab-icon { font-size: 24px; display: block; margin-bottom: 4px; }

        /* Vistas (Tabs) */
        .view { display: none; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos espec√≠ficos */
        .progress-bar-container {
            background: #E5E5EA;
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            background: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-box {
            background: #E5E5EA;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-number { font-size: 24px; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 12px; color: var(--text-sec); text-transform: uppercase; }

        .star-rating { display: flex; justify-content: center; gap: 5px; margin-bottom: 15px; }
        .star { font-size: 30px; color: #D1D1D6; cursor: pointer; }
        .star.selected { color: #FFD60A; }

    </style>
</head>
<body>

    <div id="view-add" class="view active">
        <h1>Registrar Libro</h1>
        <div class="card">
            <input type="text" id="add-title" placeholder="T√≠tulo del libro">
            <input type="text" id="add-author" placeholder="Autor">
            
            <label style="font-size: 14px; color: var(--text-sec); margin-left: 5px;">Estado inicial</label>
            <select id="add-status" onchange="toggleDateInputs()">
                <option value="reading">Leyendo ahora</option>
                <option value="want">Quiero leer</option>
                <option value="read">Le√≠do</option>
            </select>

            <div id="date-container">
                <label style="font-size: 12px; color: var(--text-sec);">Fecha inicio</label>
                <input type="date" id="add-start">
                <div id="end-date-wrapper" style="display:none;">
                    <label style="font-size: 12px; color: var(--text-sec);">Fecha t√©rmino</label>
                    <input type="date" id="add-end">
                    <div class="star-rating" id="add-rating-container">
                        <span class="star" onclick="setRating(1)">‚òÖ</span>
                        <span class="star" onclick="setRating(2)">‚òÖ</span>
                        <span class="star" onclick="setRating(3)">‚òÖ</span>
                        <span class="star" onclick="setRating(4)">‚òÖ</span>
                        <span class="star" onclick="setRating(5)">‚òÖ</span>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="addBook()">Guardar Libro</button>
        </div>
    </div>

    <div id="view-reading" class="view">
        <h1>Leyendo</h1>
        <div id="reading-list"></div>
    </div>

    <div id="view-want" class="view">
        <h1>Por Leer</h1>
        <div id="want-list"></div>
    </div>

    <div id="view-stats" class="view">
        <h1>Estad√≠sticas</h1>
        <div id="stats-content"></div>
    </div>

    <div id="view-challenge" class="view">
        <h1>Desaf√≠o 2025</h1>
        <div class="card" style="text-align: center;">
            <h2 id="challenge-percent">0%</h2>
            <p style="color:var(--text-sec); margin-bottom: 20px;">Completado</p>
            
            <div class="progress-bar-container" style="height: 20px;">
                <div id="challenge-bar" class="progress-bar"></div>
            </div>
            
            <div class="stat-grid" style="margin-top: 20px;">
                <div class="stat-box">
                    <div class="stat-number" id="challenge-read">0</div>
                    <div class="stat-label">Le√≠dos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="challenge-target">0</div>
                    <div class="stat-label">Meta</div>
                </div>
            </div>

            <button class="btn secondary" style="margin-top: 20px;" onclick="setChallengeGoal()">Definir Meta Anual</button>
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('view-add', this)">
            <span class="tab-icon">‚úö</span>Registrar
        </div>
        <div class="tab-item" onclick="switchTab('view-reading', this)">
            <span class="tab-icon">üìñ</span>Leyendo
        </div>
        <div class="tab-item" onclick="switchTab('view-want', this)">
            <span class="tab-icon">üîñ</span>Lista
        </div>
        <div class="tab-item" onclick="switchTab('view-stats', this)">
            <span class="tab-icon">üìä</span>Stats
        </div>
        <div class="tab-item" onclick="switchTab('view-challenge', this)">
            <span class="tab-icon">üèÜ</span>Desaf√≠o
        </div>
    </div>

    <script>
        // --- ESTADO Y ALMACENAMIENTO ---
        let books = JSON.parse(localStorage.getItem('myBooks')) || [];
        let challengeGoal = parseInt(localStorage.getItem('readingChallenge')) || 12;
        let tempRating = 0;

        // --- FUNCIONES DE INTERFAZ ---
        function switchTab(viewId, tabElement) {
            // Ocultar vistas
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            // Actualizar tabs
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            tabElement.classList.add('active');

            // Recargar datos de la vista
            if(viewId === 'view-reading') renderReading();
            if(viewId === 'view-want') renderWant();
            if(viewId === 'view-stats') renderStats();
            if(viewId === 'view-challenge') renderChallenge();
        }

        function toggleDateInputs() {
            const status = document.getElementById('add-status').value;
            const dateContainer = document.getElementById('date-container');
            const endWrapper = document.getElementById('end-date-wrapper');

            if (status === 'want') {
                dateContainer.style.display = 'none';
            } else {
                dateContainer.style.display = 'block';
                if (status === 'read') {
                    endWrapper.style.display = 'block';
                } else {
                    endWrapper.style.display = 'none';
                }
            }
        }

        function setRating(n) {
            tempRating = n;
            const stars = document.querySelectorAll('#add-rating-container .star');
            stars.forEach((s, index) => {
                s.classList.toggle('selected', index < n);
            });
        }

        // --- L√ìGICA DE NEGOCIO ---

        function addBook() {
            const title = document.getElementById('add-title').value;
            const author = document.getElementById('add-author').value;
            const status = document.getElementById('add-status').value;
            const start = document.getElementById('add-start').value;
            const end = document.getElementById('add-end').value;

            if(!title) return alert("Ingresa un t√≠tulo");

            const newBook = {
                id: Date.now(),
                title,
                author,
                status,
                startDate: (status !== 'want') ? (start || new Date().toISOString().split('T')[0]) : null,
                endDate: (status === 'read') ? (end || new Date().toISOString().split('T')[0]) : null,
                rating: (status === 'read') ? tempRating : 0,
                progress: 0
            };

            books.push(newBook);
            saveData();
            
            // Reset form
            document.getElementById('add-title').value = '';
            document.getElementById('add-author').value = '';
            tempRating = 0;
            setRating(0);
            alert("Libro guardado");
        }

        function saveData() {
            localStorage.setItem('myBooks', JSON.stringify(books));
            localStorage.setItem('readingChallenge', challengeGoal);
        }

        // --- RENDERIZADO: LEYENDO ---
        function renderReading() {
            const container = document.getElementById('reading-list');
            container.innerHTML = '';
            const readingBooks = books.filter(b => b.status === 'reading');

            if(readingBooks.length === 0) container.innerHTML = '<p style="text-align:center;color:var(--text-sec);margin-top:50px;">No est√°s leyendo nada actualmente.</p>';

            readingBooks.forEach(book => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <h3>${book.title}</h3>
                    <p style="color:var(--text-sec); margin-bottom:15px;">${book.author}</p>
                    <label style="font-size:12px;">Progreso: <span id="val-${book.id}">${book.progress}</span>%</label>
                    <input type="range" min="0" max="100" value="${book.progress}" oninput="updateProgress(${book.id}, this.value)" style="width:100%; margin: 10px 0;">
                    <button class="btn success" onclick="finishBook(${book.id})">Terminar Libro</button>
                `;
                container.appendChild(div);
            });
        }

        function updateProgress(id, val) {
            const book = books.find(b => b.id === id);
            if(book) {
                book.progress = val;
                document.getElementById(`val-${id}`).innerText = val;
                saveData();
            }
        }

        function finishBook(id) {
            const rating = prompt("Califica del 1 al 5:", "5");
            if(rating !== null) {
                const book = books.find(b => b.id === id);
                book.status = 'read';
                book.endDate = new Date().toISOString().split('T')[0];
                book.rating = parseInt(rating);
                book.progress = 100;
                saveData();
                renderReading();
            }
        }

        // --- RENDERIZADO: QUIERO LEER ---
        function renderWant() {
            const container = document.getElementById('want-list');
            container.innerHTML = '';
            const wantBooks = books.filter(b => b.status === 'want');

            if(wantBooks.length === 0) container.innerHTML = '<p style="text-align:center;color:var(--text-sec);margin-top:50px;">Tu lista est√° vac√≠a.</p>';

            wantBooks.forEach(book => {
                const div = document.createElement('div');
                div.className = 'card';
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.alignItems = 'center';
                div.innerHTML = `
                    <div>
                        <h3 style="font-size:18px;">${book.title}</h3>
                        <p style="color:var(--text-sec); font-size:14px;">${book.author}</p>
                    </div>
                    <button class="btn small" onclick="startReading(${book.id})">Leer</button>
                `;
                container.appendChild(div);
            });
        }

        function startReading(id) {
            const book = books.find(b => b.id === id);
            book.status = 'reading';
            book.startDate = new Date().toISOString().split('T')[0];
            saveData();
            renderWant();
        }

        // --- RENDERIZADO: ESTAD√çSTICAS ---
        function renderStats() {
            const container = document.getElementById('stats-content');
            container.innerHTML = '';
            
            // Agrupar por a√±o
            const booksRead = books.filter(b => b.status === 'read' && b.endDate);
            const years = {};

            booksRead.forEach(b => {
                const y = b.endDate.split('-')[0];
                if(!years[y]) years[y] = { count: 0, sumRating: 0 };
                years[y].count++;
                years[y].sumRating += b.rating;
            });

            const sortedYears = Object.keys(years).sort().reverse();

            if(sortedYears.length === 0) container.innerHTML = '<p style="text-align:center;color:var(--text-sec);">A√∫n no hay libros le√≠dos.</p>';

            sortedYears.forEach(year => {
                const data = years[year];
                const avg = (data.sumRating / data.count).toFixed(1);
                
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h2>${year}</h2>
                        <span style="font-size:20px; font-weight:bold; color:var(--primary);">${avg} ‚òÖ</span>
                    </div>
                    <p style="color:var(--text-sec);">${data.count} libros le√≠dos</p>
                `;
                container.appendChild(div);
            });
        }

        // --- RENDERIZADO: DESAF√çO ---
        function renderChallenge() {
            const currentYear = new Date().getFullYear().toString();
            const readThisYear = books.filter(b => b.status === 'read' && b.endDate && b.endDate.startsWith(currentYear)).length;
            
            let percent = Math.round((readThisYear / challengeGoal) * 100);
            
            document.getElementById('challenge-read').innerText = readThisYear;
            document.getElementById('challenge-target').innerText = challengeGoal;
            document.getElementById('challenge-percent').innerText = percent + "%";
            document.getElementById('challenge-bar').style.width = Math.min(percent, 100) + "%"; // La barra visual se llena hasta 100%
            
            if(percent > 100) {
                 document.getElementById('challenge-bar').style.backgroundColor = '#FFD60A'; // Oro si pasas la meta
            } else {
                 document.getElementById('challenge-bar').style.backgroundColor = 'var(--primary)';
            }
        }

        function setChallengeGoal() {
            const goal = prompt("¬øCu√°ntos libros quieres leer este a√±o?", challengeGoal);
            if(goal) {
                challengeGoal = parseInt(goal);
                saveData();
                renderChallenge();
            }
        }

        // Inicializar vista por defecto (Stats o Add)
        // No es necesario llamar nada, el HTML tiene "active" en la primera vista.
    </script>
</body>
</html>